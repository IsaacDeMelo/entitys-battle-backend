<!DOCTYPE html>
<html>
<head>
    <title>Admin Lab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body { background: #1a1a2e; color: #ecf0f1; font-family: 'Roboto', sans-serif; padding: 0; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        .header { background: #111; padding: 15px; display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid #3498db; }
        .header h1 { margin: 0; font-family: 'Press Start 2P'; font-size: 1rem; color: #f1c40f; }
        .btn-cancel { background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-weight: bold; cursor: pointer; text-decoration: none; font-size: 0.9rem; }
        
        .tabs { display: flex; background: #2c3e50; overflow-x: auto; }
        .tab-btn { flex: 1; padding: 15px; text-align: center; cursor: pointer; color: #aaa; font-weight: bold; min-width: 100px; border-bottom: 4px solid transparent; user-select: none; }
        .tab-btn.active { color: white; background: #34495e; border-bottom-color: #3498db; }
        
        .content-area { flex: 1; overflow-y: auto; padding: 20px; display: none; }
        .content-area.active { display: block; }
        
        /* Form Styles */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.85rem; color: #bdc3c7; }
        input, select, textarea { width: 100%; padding: 10px; background: #0f0f15; border: 1px solid #444; color: white; border-radius: 6px; font-size: 1rem; }
        input:focus, select:focus, textarea:focus { border-color: #3498db; outline: none; }
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }
        .btn-submit { width: 100%; padding: 15px; background: #2ecc71; color: white; border: none; font-weight: bold; font-size: 1rem; cursor: pointer; border-radius: 6px; margin-top: 10px; }
        
        /* List Styles */
        .poke-item { background: #2c3e50; padding: 10px; margin-bottom: 8px; border-radius: 8px; display: flex; align-items: center; gap: 10px; cursor: pointer; border: 1px solid #34495e; }
        .poke-item:hover { background: #34495e; border-color: #f1c40f; }
        .poke-item img { width: 40px; height: 40px; image-rendering: pixelated; background: rgba(0,0,0,0.3); border-radius: 50%; object-fit: contain; }
        
        /* Manual & Moves Styles */
        .manual-box, .moves-box { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; font-family: monospace; line-height: 1.5; }
        .move-card { background: #111; padding: 8px; margin-bottom: 5px; border-left: 4px solid #3498db; display: flex; justify-content: space-between; align-items: center; }
        .type-badge { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; text-transform: uppercase; color: #000; font-weight: bold; }
        
        /* Responsive */
        @media (max-width: 600px) {
            .row { flex-direction: column; }
            .header h1 { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>GENETICS LAB</h1>
        <a href="/lobby?userId=<%= user._id %>" class="btn-cancel">SAIR</a>
    </div>
    
    <div class="tabs">
        <div class="tab-btn active" onclick="switchTab('tab-create')">CRIAR/EDITAR</div>
        <div class="tab-btn" onclick="switchTab('tab-list')">LISTA</div>
        <div class="tab-btn" onclick="switchTab('tab-moves')">GOLPES</div>
        <div class="tab-btn" onclick="switchTab('tab-manual')">GUIA</div>
    </div>
    
    <!-- ABA CRIAR -->
    <div id="tab-create" class="content-area active">
        <form action="/lab/create" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="existingId" id="existingId">
            
            <div class="form-group">
                <label>Nome do Pokémon</label>
                <input type="text" name="name" id="pName" required placeholder="Ex: Charizard">
            </div>
            
            <div class="row">
                <div class="col form-group">
                    <label>Tipo</label>
                    <select name="type" id="pType">
                        <% for(let t in types) { %><option value="<%= types[t] %>"><%= types[t].toUpperCase() %></option><% } %>
                    </select>
                </div>
                <div class="col form-group">
                    <label>Imagem (Sprite)</label>
                    <input type="file" name="sprite" style="padding: 7px;">
                </div>
            </div>
            
            <div class="row">
                <div class="col form-group"><label>HP Base</label><input type="number" name="hp" id="pHp" value="50"></div>
                <div class="col form-group"><label>Energy</label><input type="number" name="energy" id="pEn" value="100"></div>
            </div>
            
            <div class="row">
                <div class="col form-group"><label>ATK</label><input type="number" name="atk" id="pAtk" value="10"></div>
                <div class="col form-group"><label>DEF</label><input type="number" name="def" id="pDef" value="10"></div>
                <div class="col form-group"><label>SPD</label><input type="number" name="spd" id="pSpd" value="10"></div>
            </div>
            
            <div class="form-group">
                <label>Spawn Location (Onde aparece)</label>
                <select name="location" id="pLoc">
                    <option value="none">Nenhum (Evolução/Inicial)</option>
                    <option value="forest">Floresta (Selvagem)</option>
                </select>
            </div>
            
            <div class="row">
                <div class="col form-group"><label>Min Lvl</label><input type="number" name="minLvl" id="pMin" value="1"></div>
                <div class="col form-group"><label>Max Lvl</label><input type="number" name="maxLvl" id="pMax" value="5"></div>
                <div class="col form-group"><label>Chance (0-1)</label><input type="number" step="0.1" name="catchRate" id="pRate" value="0.5"></div>
            </div>
            
            <div class="row">
                <div class="col form-group"><label>Evolui para (ID)</label><input type="text" name="evoTarget" id="pEvoT" placeholder="ID do monstro"></div>
                <div class="col form-group"><label>Nível Evo</label><input type="number" name="evoLevel" id="pEvoL" value="100"></div>
            </div>
            
            <div class="form-group">
                <label>Moveset (JSON) - Consulte a aba Golpes</label>
                <textarea name="movesJson" id="pMoves" rows="4" placeholder='[{"level":1,"moveId":"tackle"}]'>[{"level":1,"moveId":"tackle"}]</textarea>
            </div>
            
            <button type="submit" class="btn-submit">SALVAR DADOS</button>
        </form>
    </div>
    
    <!-- ABA LISTA -->
    <div id="tab-list" class="content-area">
        <h3>Banco de Dados</h3>
        <% pokemons.forEach(p => { %>
            <div class="poke-item" onclick='loadData(<%- JSON.stringify(p) %>)'>
                <% if(p.sprite) { %>
                    <img src="<%= p.sprite %>">
                <% } else { %>
                    <div style="width:40px;height:40px;border-radius:50%;background:#555;display:flex;align-items:center;justify-content:center;">?</div>
                <% } %>
                <div>
                    <div style="font-weight:bold; color:#f1c40f"><%= p.name %></div>
                    <div style="font-size:0.7rem; color:#aaa">ID: <%= p.id %> | Type: <%= p.type %></div>
                </div>
            </div>
        <% }) %>
    </div>
    
    <!-- ABA GOLPES -->
    <div id="tab-moves" class="content-area">
        <h3>Biblioteca de Golpes</h3>
        <p style="font-size:0.8rem; color:#aaa; margin-bottom:10px;">Use o ID do golpe no JSON do Moveset.</p>
        <div class="moves-box">
            <% Object.values(moves).forEach(m => { %>
                <div class="move-card">
                    <div>
                        <div style="font-weight:bold; color:#fff"><%= m.name %></div>
                        <div style="font-size:0.7rem; color:#aaa">ID: <span style="color:#f1c40f"><%= m.id %></span> | Power: <%= m.power %></div>
                    </div>
                    <div class="type-badge" style="background:#ddd"><%= m.element || m.type %></div>
                </div>
            <% }) %>
        </div>
    </div>
    
    <!-- ABA MANUAL -->
    <div id="tab-manual" class="content-area">
        <h3>Manual do Criador</h3>
        <div class="manual-box">
            <p><strong>1. Balanceamento:</strong></p>
            <ul>
                <li><strong>HP:</strong> Vida base. Iniciais tem ~50.</li>
                <li><strong>Energy:</strong> Gasta ao usar golpes. Base ~100.</li>
                <li><strong>ATK/DEF:</strong> Influenciam dano. Base ~10.</li>
                <li><strong>SPD:</strong> Quem ataca primeiro.</li>
            </ul>
            <p><strong>2. Spawn:</strong></p>
            <ul>
                <li>Selecione 'Floresta' para aparecerem no matinho.</li>
                <li>'Nenhum' para lendários, evoluções ou iniciais exclusivos.</li>
            </ul>
            <p><strong>3. Moveset (JSON):</strong></p>
            <p>Formato estrito. Exemplo para um pokemon com 2 golpes:</p>
            <pre style="background:#000; padding:10px; color:#2ecc71; overflow-x:auto;">
[
  {"level": 1, "moveId": "tackle"},
  {"level": 5, "moveId": "ember"}
]
            </pre>
            <p>Isso significa: Aprende Tackle no Nível 1 e Ember no Nível 5.</p>
        </div>
    </div>
    
    <script>
        function switchTab(id) {
            document.querySelectorAll('.content-area').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function loadData(p) {
            switchTab('tab-create');
            document.getElementById('existingId').value = p.id; 
            document.getElementById('pName').value = p.name; 
            document.getElementById('pType').value = p.type;
            document.getElementById('pHp').value = p.baseStats.hp; 
            document.getElementById('pEn').value = p.baseStats.energy;
            document.getElementById('pAtk').value = p.baseStats.attack; 
            document.getElementById('pDef').value = p.baseStats.defense; 
            document.getElementById('pSpd').value = p.baseStats.speed;
            document.getElementById('pLoc').value = p.spawnLocation || 'none'; 
            document.getElementById('pMin').value = p.minSpawnLevel || 1; 
            document.getElementById('pMax').value = p.maxSpawnLevel || 5;
            document.getElementById('pRate').value = p.catchRate || 0.5;
            
            if(p.evolution) { 
                document.getElementById('pEvoT').value = p.evolution.targetId || ''; 
                document.getElementById('pEvoL').value = p.evolution.level || ''; 
            } else {
                document.getElementById('pEvoT').value = ''; 
                document.getElementById('pEvoL').value = '';
            }
            
            document.getElementById('pMoves').value = JSON.stringify(p.movePool || []);
        }
    </script>
</body>
</html>