<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Goofymon - Aventura</title>
    <!-- Viewport crucial para mobile: evita zoom indesejado e ajusta a escala -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3498db;
            --accent: #f1c40f;
            --bg-dark: #0f172a;
            --panel-bg: rgba(30, 41, 59, 0.95);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            background: radial-gradient(circle at center, #1e293b 0%, #000000 100%);
            color: white; 
            font-family: 'Rajdhani', sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px;
            overflow-y: auto; /* Permite scroll se o teclado do celular subir */
        }

        /* Container Principal */
        .box { 
            background: var(--panel-bg); 
            padding: 30px 20px; 
            border: 1px solid rgba(255,255,255,0.1); 
            width: 100%; 
            max-width: 400px; 
            border-radius: 20px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.7); 
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        /* Detalhe decorativo no topo */
        .box::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        h1 {
            font-family: 'Press Start 2P', cursive;
            color: var(--accent);
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 25px;
            text-shadow: 2px 2px 0 #000;
            line-height: 1.5;
        }

        /* Inputs Modernos */
        input, select { 
            width: 100%; 
            padding: 15px; 
            margin: 8px 0; 
            background: rgba(0,0,0,0.4); 
            border: 1px solid #334155; 
            color: white; 
            border-radius: 12px; 
            font-size: 1rem;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            outline: none;
            transition: 0.3s;
        }
        input:focus, select:focus {
            border-color: var(--primary);
            background: rgba(0,0,0,0.6);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        /* Botão Principal */
        button.btn-action { 
            width: 100%; 
            padding: 16px; 
            background: linear-gradient(135deg, var(--primary), #2980b9); 
            border: none; 
            color: white; 
            font-weight: 800; 
            font-size: 1.1rem;
            cursor: pointer; 
            margin-top: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 0 #1c5980;
            transition: transform 0.1s;
        }
        button.btn-action:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* Abas de Navegação */
        .tab-container { 
            display: flex; 
            background: rgba(0,0,0,0.3); 
            border-radius: 12px; 
            padding: 4px; 
            margin-bottom: 25px;
        }
        .tab { 
            flex: 1; 
            padding: 12px; 
            cursor: pointer; 
            text-align: center; 
            border-radius: 8px; 
            font-weight: bold;
            color: #94a3b8;
            transition: 0.3s;
        }
        .tab.active { 
            background: var(--bg-dark); 
            color: white; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* --- ÁREA DE PREVIEW DA SKIN --- */
        .skin-section {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        /* O "Palco" onde o boneco fica */
        .sprite-preview-box {
            width: 64px;
            height: 64px;
            background: #111;
            border-radius: 8px;
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: inset 0 0 10px #000;
        }

        /* O Boneco Animado */
        .character-sprite {
            width: 48px; 
            height: 48px;
            background-image: none;
            background-size: 400% auto; /* Lógica do 4x4 */
            image-rendering: pixelated;
            background-position-y: 0%; /* Olhando para baixo */
            animation: walk-anim 0.8s steps(4) infinite; /* Animação de andar */
            transform: scale(1.2); /* Aumenta um pouco visualmente */
        }

        @keyframes walk-anim { 
            from { background-position-x: 0; } 
            to { background-position-x: -400%; } 
        }

        /* --- SELEÇÃO DE INICIAIS --- */
        .starters-container {
            display: flex; 
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .starter-opt { 
            cursor: pointer; 
            position: relative;
            transition: 0.2s;
        }
        .starter-opt img { 
            width: 85px; /* Bem maior */
            height: 85px; 
            object-fit: contain;
            image-rendering: pixelated;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5)) grayscale(0.6);
            transition: 0.3s;
        }
        .starter-opt input { display: none; }
        
        /* Estado Selecionado do Inicial */
        .starter-opt input:checked + img { 
            filter: drop-shadow(0 0 10px var(--accent)) grayscale(0);
            transform: scale(1.15) translateY(-5px);
        }
        /* Indicador visual abaixo do pokemon */
        .starter-opt input:checked + img::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            width: 30px; height: 4px; background: var(--accent); border-radius: 2px;
        }

        .error-msg {
            background: rgba(231, 76, 60, 0.2);
            color: #ff6b6b;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        /* Label pequena */
        .form-label {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 5px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Ajuste para telas muito pequenas */
        @media (max-height: 600px) {
            .box { padding: 15px; margin: 10px 0; }
            h1 { font-size: 1.2rem; margin-bottom: 15px; }
            .starter-opt img { width: 70px; height: 70px; }
        }
    </style>
</head>
<body>

    <div class="box">
        <h1>GOOFYMON</h1>

        <div class="tab-container">
            <div id="tabLogin" class="tab active" onclick="switchTab('login')">ENTRAR</div>
            <div id="tabRegister" class="tab" onclick="switchTab('register')">NOVA CONTA</div>
        </div>

        <!-- FORMULÁRIO DE LOGIN -->
        <form id="formLogin" action="/login" method="POST">
            <label class="form-label">Credenciais</label>
            <input type="text" name="username" placeholder="Seu Usuário" required autocomplete="username">
            <input type="password" name="password" placeholder="Sua Senha" required autocomplete="current-password">
            <button class="btn-action">JOGAR AGORA</button>
        </form>

        <!-- FORMULÁRIO DE REGISTRO -->
        <form id="formRegister" action="/register" method="POST" style="display:none;">
            <label class="form-label">Identidade</label>
            <input type="text" name="username" placeholder="Nome do Treinador" required autocomplete="off">
            <input type="password" name="password" placeholder="Senha Secreta" required autocomplete="new-password">

            <label class="form-label" style="margin-top: 10px;">Visual</label>
            
            <!-- PREVIEW DA SKIN INTEGRADO -->
            <div class="skin-section">
                <div class="sprite-preview-box">
                    <div id="charPreview" class="character-sprite"></div>
                </div>
                <div style="flex: 1;">
                    <select id="skinSelect" name="skin" onchange="updateSkinPreview(this.value)">
                        <% if (skins && skins.length > 0) { %>
                            <% skins.forEach(s => { %>
                                <option value="<%= s._id %>"><%= s.name %></option>
                            <% }) %>
                        <% } else { %>
                            <option value="" disabled selected>Nenhuma skin cadastrada (admin: crie no LAB)</option>
                        <% } %>
                    </select>
                </div>
            </div>

            <label class="form-label" style="margin-top: 15px; text-align: center;">Seu monstro inicial</label>
            <div style="text-align:center; color:#aaa; font-size:0.85rem; line-height:1.35; margin: 6px 0 10px;">
                Você não escolhe no registro. Dentro do jogo existe um NPC especial que oferece 3 opções.
            </div>

            <button class="btn-action" style="background: linear-gradient(135deg, #2ecc71, #27ae60); box-shadow: 0 4px 0 #1e8449;">COMEÇAR JORNADA</button>
        </form>

        <% if(typeof error !== 'undefined' && error) { %>
            <div class="error-msg">⚠️ <%= error %></div>
        <% } %>
    </div>

    <script>
        // Lógica de Abas
        function switchTab(mode) {
            document.getElementById('formLogin').style.display = mode === 'login' ? 'block' : 'none';
            document.getElementById('formRegister').style.display = mode === 'register' ? 'block' : 'none';
            
            document.getElementById('tabLogin').className = mode === 'login' ? 'tab active' : 'tab';
            document.getElementById('tabRegister').className = mode === 'register' ? 'tab active' : 'tab';
        }

        // Lógica do Preview de Skin
        function updateSkinPreview(skinName) {
            const previewEl = document.getElementById('charPreview');
            const s = String(skinName || '').trim();
            if (!s) {
                previewEl.style.backgroundImage = 'none';
                return;
            }
            previewEl.style.backgroundImage = `url('/skins/${encodeURIComponent(s)}.png')`;
        }

        // Inicializa o preview com o valor atual do select
        document.addEventListener('DOMContentLoaded', () => {
            const select = document.getElementById('skinSelect');
            if(select && select.value) {
                updateSkinPreview(select.value);
            }

            // Se não tiver skins cadastradas, desabilita o botão de registro.
            const registerForm = document.getElementById('formRegister');
            const registerBtn = registerForm ? registerForm.querySelector('button.btn-action') : null;
            if (registerBtn) {
                const hasOption = select && select.value;
                registerBtn.disabled = !hasOption;
                registerBtn.style.opacity = hasOption ? '1' : '0.6';
                registerBtn.style.cursor = hasOption ? 'pointer' : 'not-allowed';
            }
        });
    </script>
</body>
</html>
